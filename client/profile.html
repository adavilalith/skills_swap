<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SkillSwap - Learn, Teach, Grow</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      --primary-green: #00E689;
      --dark-bg: #1C1C1C;
      --darker-bg: #171717;
      --input-bg: #2A2A2A;
      --border-color: #333333;
      --text-primary: #FFFFFF;
      --text-secondary: #A1A1AA;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background-color: var(--darker-bg);
      color: var(--text-primary);
    }

    input, select {
      background-color: var(--input-bg);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      border-radius: 8px;
      padding: 12px 16px;
    }

    input:focus, select:focus {
      border-color: var(--primary-green);
      outline: none;
    }

    button {
      background-color: var(--primary-green);
      color: var(--darker-bg);
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-weight: 500;
      transition: all 0.2s;
    }

    button:hover {
      opacity: 0.9;
    }

    button.secondary {
      background-color: var(--input-bg);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    h1, h2 {
      color: var(--primary-green);
    }

    .nav-link {
      @apply flex items-center gap-2 text-gray-300 hover:text-white transition-colors;
    }

    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #1a1a1a;
    }
    ::-webkit-scrollbar-thumb {
      background: #404040;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
  </style>
</head>

<body class="bg-dark-800 text-gray-100 font-sans">

<!-- Navigation -->
<nav class="bg-[#1C1C1C] border-b border-[#2a2a2a] fixed w-full z-50">
  <div class="max-w-7xl mx-auto px-4">
    <div class="flex items-center justify-between h-16">
      <!-- Left -->
      <div class="flex items-center gap-6">
        <a href="#" class="text-[#00E689] text-xl font-bold">SkillSwap</a>
        <a href="#" class="nav-link">
          <i class="fas fa-home"></i><span>Home</span>
        </a>
        <div class="relative nav-link">
          <i class="fas fa-search"></i><span>Search</span>
        </div>
        <a href="./forum.html" class="nav-link">
          <i class="fas fa-bell"></i><span>Forum</span>
        </a>
        <a href="./chat.html" class="nav-link">
          <i class="fas fa-envelope"></i><span>Messages</span>
        </a>
      </div>

      <!-- Right -->
      <div class="flex items-center gap-4">
        <div class="relative" id="profileDropdown">
          <button class="w-8 h-8 rounded-full bg-primary-400 flex items-center justify-center hover:ring-2 hover:ring-primary-300" onclick="toggleDropdown()">
            <span class="font-medium text-dark-800" id="userInitials">JD</span>
          </button>
          <div class="hidden absolute right-0 mt-2 w-48 bg-dark-800 rounded-lg shadow-xl border border-dark-600 py-1" id="dropdownMenu">
            <a href="#" class="block px-4 py-3 text-sm text-gray-200 hover:bg-[#00E689] hover:text-black transition">
              <i class="fas fa-user mr-2"></i>Profile
            </a>
            <a href="#" onclick="logout()" class="block px-4 py-3 text-sm text-gray-200 hover:bg-[#00E689] hover:text-black transition">
              <i class="fas fa-sign-out-alt mr-2"></i>Logout
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- Main -->
<main class="pt-24 px-4">
  <!-- Welcome Section -->
  <div class="mb-8 bg-[#0C3125] p-8 rounded">
    <h1 class="text-3xl font-bold">Welcome Back, <span id="welcomeUsername">User</span>!</h1>
    <p class="text-gray-300 mt-2">Continue building your network by connecting with professionals.</p>
  </div>

  <!-- (empty for now) -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold mb-6">Profile</h2>
    <div class="bg-dark-700 border border-dark-600 rounded-xl p-8 text-center">
      <!-- Profile content here -->
       <!-- Profile Section -->
<section class="mb-12">
    <div class="text-left text-gray-200">
      <h3 class="text-xl font-semibold" id="profileName">John Doe</h3>
      <p class="text-sm text-gray-400" id="profileUsername">@johndoe</p>
      <p class="text-sm text-gray-400" id="profileEmail">johndoe@example.com</p>
      <p class="mt-4" id="profileBio">
        Bio: I am a Full Stack Developer passionate about building web applications.
      </p>
      <p class="mt-2" id="profileSkills">
        Skills: JavaScript, Node.js, React, MongoDB
      </p>
      <p class="mt-2" id="profileGoals">
        Goals: Improve coding skills, Contribute to open source, Build a personal website
      </p>
</section>

    </div>
  </section>

  <!-- People You May Know -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold mb-6">People You May Know</h2>
    <div class="overflow-x-auto pb-4">
      <div class="flex gap-4 min-w-max" id="connectionsWrapper">

        <!-- Card -->
        <div class="bg-[#1C1C1C] rounded-xl p-6 w-[280px] flex flex-col items-center" id="profileCard">
          <div class="w-20 h-20 rounded-full bg-[#2A2A2A] flex items-center justify-center text-2xl font-bold mb-4" id="profileInitials">JD</div>
          <h3 class="text-xl font-semibold mb-2" id="profileName">John Doe</h3>
          <p class="text-gray-400 text-sm mb-4" id="profileRole">Full Stack Developer</p>
          <div class="flex gap-2 w-full mb-4">
            <button class="flex-1 bg-[#00E689] text-black py-2 rounded-lg hover:opacity-90" id="followBtn">Follow</button>
            <button class="flex-1 border border-[#333] py-2 rounded-lg hover:bg-[#333]" id="connectBtn">Connect</button>
          </div>
          <button class="w-full bg-[#2A2A2A] py-2 rounded-lg hover:bg-[#333]" id="messageBtn">Message</button>
        </div>
        
        <script>
          document.addEventListener('DOMContentLoaded', async function() {
            try {
              // Fetch user data from your Express API
              const response = await fetch('https://probable-rotary-phone-6j566gxq64qh5v6x-3000.app.github.dev/api/getUserInfo/dBQgyd5j28vAu6j9tBRv');
              const userData = await response.json();
              if (userData) {


                // Dynamically set profile info based on the API response
                document.getElementById('profileInitials').textContent = 'NA';
                document.getElementById('profileName').textContent = userData.firstName+" "+userData.lastName || 'John Doe';
                document.getElementById('profileUsername').textContent = "@"+userData.username ||   '@JohnDo111e';
                document.getElementById('profileEmail').textContent = userData.email ||   '@JohnDo111e';
                document.getElementById('profileSkills').textContent = "Skills: ";
                for(skill in userData.skills  ){
                  document.getElementById('profileSkills').textContent += skill +", ";
                }
                document.getElementById('profileGoals').textContent = "Goals: ";

                for(goal in userData.goals){
                  document.getElementById('profileGoals').textContent += userData.goals[goal] + ", ";
                }
                profileSkills
                
                // Optionally update button behaviors (Follow, Connect, Message)
                document.getElementById('followBtn').textContent = userData.isFollowing ? 'Following' : 'Follow';
                document.getElementById('connectBtn').textContent = userData.isConnected ? 'Connected' : 'Connect';
        
                // Handle follow button click (example logic)
                document.getElementById('followBtn').addEventListener('click', function() {
                  // Call your API to follow/unfollow the user
                  fetch('/api/user/follow', { method: 'POST', body: JSON.stringify({ userId: userData.id }) })
                    .then(res => res.json())
                    .then(data => {
                      // Toggle button text based on success response
                      if (data.success) {
                        document.getElementById('followBtn').textContent = data.isFollowing ? 'Following' : 'Follow';
                      }
                    });
                });
        
                // Handle connect button click
                document.getElementById('connectBtn').addEventListener('click', function() {
                  fetch('/api/user/connect', { method: 'POST', body: JSON.stringify({ userId: userData.id }) })
                    .then(res => res.json())
                    .then(data => {
                      if (data.success) {
                        document.getElementById('connectBtn').textContent = data.isConnected ? 'Connected' : 'Connect';
                      }
                    });
                });
        
                // Handle message button click
                document.getElementById('messageBtn').addEventListener('click', function() {
                  // Redirect to message interface or open message modal
                  window.location.href = `/messages/${userData.id}`;
                });
              }
            } catch (error) {
              console.error('Error fetching user data:', error);
            }
          });
        </script>
        <script>
           const handleFollowClick = async (fromUid,toUid) => {
            console.log("Follow button clicked for user:", toUid);
            try {
              await fetch(`https://probable-rotary-phone-6j566gxq64qh5v6x-3000.app.github.dev/api/followUser`, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({fromUid:fromUid, toUid:toUid})
              });
              console.log("Followed user:", toUid);
              // following = document.getElementById(`follow${toUid}`).textContent;
              // document.getElementById(`follow${toUid}`).textContent = following === "Follow" ? "Following" : "Follow";
            } catch (error) {
              console.error("Error following user:", error);
            }
          }
           document.addEventListener('DOMContentLoaded', async function() {
            console.log("Fetching recommended users...");
            try{
              // console.log("Fetching recommended users...");
              const response = await fetch("https://probable-rotary-phone-6j566gxq64qh5v6x-3000.app.github.dev/api/getReccomemdedUsers/", {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({ uuid: 'dBQgyd5j28vAu6j9tBRv' })
              });
              const data = await response.json();
              console.log("reccomended users:", data)

              for(let i=0;i<data.length;i++){
                const user = data[i];
                const response = await fetch(`https://probable-rotary-phone-6j566gxq64qh5v6x-3000.app.github.dev/api/getUserInfo/${data[i]}`);
                const userData = await response.json();

                const card = document.createElement('div');
                card.className = 'bg-[#1C1C1C] rounded-xl p-6 w-[280px] flex flex-col items-center';
                card.innerHTML = `
                  <div class="w-20 h-20 rounded-full bg-[#2A2A2A] flex items-center justify-center text-2xl font-bold mb-4">${"NA"}</div>
                  <h3 class="text-xl font-semibold mb-2">${userData.username}</h3>
                  <p class="text-gray-400 text-sm mb-4">${userData.email}</p>
                  <div class="flex gap-2 w-full mb-4">
                    <button id=${"follow"+data[i]} onclick="handleFollowClick("dBQgyd5j28vAu6j9tBRv",${data[i]})" class="flex-1 bg-[#00E689] text-black py-2 rounded-lg hover:opacity-90">Follow</button>
                    <button id=${"connection"+data[i]} class="flex-1 border bordeetar-[#333] py-2 rounded-lg hover:bg-[#333]">Connect</button>
                  </div>
                  <button id=${"message"+data[i]} class="w-full bg-[#2A2A2A] py-2 rounded-lg hover:bg-[#333]">Message</button>
                `;
                document.getElementById('connectionsWrapper').appendChild(card);
              }

            }catch(e){
              console.log(e)
            }
          })
        </script>        

      </div>
    </div>
  </section>
</main>

<!-- Firebase + Scripts -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
  import { getFirestore } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAhEwHby9iJm5YjMjGSXp4tAHu3PhAol6k",
    authDomain: "skillclassneet.firebaseapp.com",
    projectId: "skillclassneet",
    storageBucket: "skillclassneet.appspot.com",
    messagingSenderId: "133285201192",
    appId: "1:133285201192:web:be0273f9bd71bbf5e33c1d"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
</script>

<script>
  function toggleDropdown() {
    const dropdown = document.getElementById('dropdownMenu');
    if (dropdown.classList.contains('hidden')) {
      dropdown.classList.remove('hidden');
      dropdown.classList.add('opacity-100', 'scale-100');
    } else {
      dropdown.classList.add('opacity-0', 'scale-95');
      setTimeout(() => dropdown.classList.add('hidden'), 200);
    }
  }

  window.addEventListener('click', function(e) {
    if (!document.getElementById('profileDropdown').contains(e.target)) {
      document.getElementById('dropdownMenu').classList.add('hidden');
    }
  });

  function logout() {
    // Add your logout logic here
    console.log("Logging out...");
  }
</script>

</body>
</html>
